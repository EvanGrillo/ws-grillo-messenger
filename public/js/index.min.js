window.addEventListener("load",e=>{var t,n=document.cookie.split("; ").filter(e=>/user_name=*/.test(e))[0]||null;n&&n.split("=")[1]?(t=n.split("=")[1],t=prompt("Welcome back "+t+". Please reenter your name")):t=prompt("Please enter your name"),window.grillo_chat={user:t,msgs:[],fileList:[]},document.querySelector("#messenger").focus();var r=location.origin.replace(/^http/,"ws");const i=new WebSocket(r);function l(e){var t={msg:e,files:window.grillo_chat.fileList||null};i.send(JSON.stringify(t)),window.grillo_chat.fileList=[],window.grillo_chat.msgs.push(t),document.querySelectorAll(".file-preview").forEach(e=>{e.remove()}),document.querySelector("#messenger").innerHTML="",document.querySelector("#send").disabled=!0}function s(e){e.target.parentElement.remove(),window.grillo_chat.fileList.forEach((t,n)=>{t.name===e.target.parentElement.fileName&&window.grillo_chat.fileList.splice(n,1)})}i.addEventListener("open",function(e){let n={user:t};document.cookie="user_name="+t,window.grillo_chat.msgs.push(n),i.send(JSON.stringify(n))}),i.onclose=function(e){alert("Your WebSocket connection is now closed.")},i.onError=function(e){alert("Error: ",e)},i.addEventListener("message",function(e){var t=JSON.parse(e.data.replace(": undefined",""));window.grillo_chat.user_id=t._id;var n=document.createElement("div");n.className="msg",n.innerHTML=t.msg;var r=document.createElement("div");r.className="avatar",r.innerText=t.user.concat(": ",new Date(t.date).toLocaleTimeString());var i=document.querySelector("#msg-container"),l=document.createElement("div");if(l.style.margin="0 auto",l.style.width="100%",l.style.display="flex",l.style.justifyContent="center",t.files&&t.files.length&&t.files.forEach(e=>{if(/image*/i.test(e.type)){var t=new Image;t.src=e.url,t.className="asset-img",l.append(t),n.prepend(l)}if(/audio*/i.test(e.type)){var r=document.createElement("audio");r.src=e.url,r.controls=!0,r.className="asset-audio",l.append(r),n.prepend(l)}if(/video*/i.test(e.type)){var i=document.createElement("video"),s=document.createElement("source");s.src=e.url,s.type=e.type,i.controls=!0,i.autoplay=!0,i.className="asset-video",i.style.width="100%",i.style.height="500px",i.appendChild(s),l.append(i),n.prepend(l)}if(/pdf*/i.test(e.type)||/doc*/i.test(e.type)||/text*/i.test(e.type)){var o=document.createElement("iframe");o.src=e.url,o.style.width="100%",o.style.height="500px",o.className="asset-iframe",n.prepend(o)}}),t.online||t.offline){var s=document.createElement("div"),o={display:"inline-block",width:"25px",height:"25px",borderRadius:"50%",marginRight:"0.5em"};Object.assign(s.style,o),t.online?s.style.background="#00ff00":s.style.background="#ff0000",o={display:"flex",alignItems:"center"},Object.assign(n.style,o),n.prepend(s)}else n.prepend(r);i.appendChild(n),i.scrollTop=i.scrollHeight}),document.querySelector("#file-input").addEventListener("change",e=>{var t=document.querySelector("#file-input").files[0],n=document.createElement("div");n.innerHTML=t.name+"<br>"+t.type,n.className="file-preview",n.height=50,n.fileName=t.name;var r=document.createElement("span");r.innerHTML="âœ–",r.className="remove",r.addEventListener("click",s),n.prepend(r),document.querySelector("form").appendChild(n);var i=new FileReader;i.readAsDataURL(t),i.onload=function(){var e={type:t.type,url:i.result,name:t.name};window.grillo_chat.fileList.push(e),document.querySelector("#file-input").value="",document.querySelector("#send").disabled=!1},i.onerror=function(e){console.log("Error: ",e)}}),document.querySelector("#messenger").addEventListener("input",e=>{e.preventDefault(),document.querySelector("#messenger").innerHTML?document.querySelector("#send").disabled=!1:document.querySelector("#send").disabled=!0}),document.querySelector("#messenger").addEventListener("keypress",e=>{var t=document.querySelector("#send").disabled;"Enter"!=e.key||e.shiftKey||t||(e.preventDefault(),l(messenger.innerHTML))}),document.querySelector("#send").addEventListener("click",e=>{let t=document.querySelector("#messenger");t.innerHTML&&(l(t.innerHTML),t.innerHTML="")})});